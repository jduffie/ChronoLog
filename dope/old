# dope_sessions Table Schema

## CREATE TABLE Statement

```sql
CREATE TABLE dope_sessions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id TEXT NOT NULL,
    session_name TEXT,
    chrono_session_id UUID REFERENCES chrono_sessions(id),
    range_submission_id UUID REFERENCES ranges_submissions(id),
    weather_source_id UUID REFERENCES weather_source(id),
    rifle_id UUID REFERENCES rifles(id),
    cartridge_type TEXT,
    cartridge_spec_id UUID,
    cartridge_lot_number TEXT,
    range_name TEXT,
    distance_m REAL,
    notes TEXT,
    status TEXT DEFAULT 'active',
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

## Recommended Indexes

```sql
CREATE INDEX idx_dope_sessions_user_id ON dope_sessions(user_id);
CREATE INDEX idx_dope_sessions_chrono_session_id ON dope_sessions(chrono_session_id);
CREATE INDEX idx_dope_sessions_range_submission_id ON dope_sessions(range_submission_id);
CREATE INDEX idx_dope_sessions_created_at ON dope_sessions(created_at DESC);
```

## Table Description

| Column Name | Data Type | Nullable | Default | Description |
|-------------|-----------|----------|---------|-------------|
| **id** | UUID | NO | gen_random_uuid() | Primary key, auto-generated unique identifier |
| **user_id** | TEXT | NO | - | Auth0 user identifier for data isolation |
| **session_name** | TEXT | YES | - | Descriptive name for the DOPE session |
| **chrono_session_id** | UUID | YES | - | Foreign key to chrono_sessions table |
| **range_submission_id** | UUID | YES | - | Foreign key to ranges_submissions table |
| **weather_source_id** | UUID | YES | - | Foreign key to weather_source table |
| **rifle_id** | UUID | YES | - | Foreign key to rifles table |
| **cartridge_type** | TEXT | YES | - | Type of cartridge ('factory' or 'custom') |
| **cartridge_spec_id** | UUID | YES | - | Reference to cartridge specification |
| **cartridge_lot_number** | TEXT | YES | - | Cartridge lot identifier |
| **range_name** | TEXT | YES | - | Name of the shooting range |
| **distance_m** | REAL | YES | - | Target distance in meters |
| **notes** | TEXT | YES | - | Session notes and observations |
| **status** | TEXT | YES | 'active' | Session status |
| **created_at** | TIMESTAMPTZ | YES | NOW() | Record creation timestamp |
| **updated_at** | TIMESTAMPTZ | YES | NOW() | Last modification timestamp |

## Foreign Key Relationships

The table has the following foreign key relationships:

- **chrono_sessions(id)** - Links to chronograph session data for velocity measurements
- **ranges_submissions(id)** - Links to shooting range information and location data
- **weather_source(id)** - Links to weather measurement devices (optional)
- **rifles(id)** - Links to rifle configuration data including barrel specifications

## Purpose and Context

The `dope_sessions` table stores "Data On Previous Engagement" sessions, which are used for ballistic analysis and tracking shooting performance across different conditions. This table serves as the metadata container for DOPE sessions, connecting:

- Chronograph data (velocity measurements)
- Range information (distance, location, environmental factors)
- Weather conditions
- Rifle configurations
- Cartridge specifications

Each DOPE session represents a shooting event where ballistic performance is recorded and analyzed for future reference and trajectory calculations.

## Key Features

1. **User Isolation**: The `user_id` field ensures data is properly isolated per user
2. **Timestamps**: Both creation and update timestamps are automatically tracked
3. **Optional Relationships**: Many foreign key fields are nullable to accommodate varying data availability
4. **Comprehensive Context**: Links multiple aspects of shooting data for complete ballistic analysis
5. **Flexible Cartridge Tracking**: Supports both factory and custom cartridge specifications